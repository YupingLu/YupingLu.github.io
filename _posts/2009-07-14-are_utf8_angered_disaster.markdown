---
author: yupinglu
comments: true
date: 2009-07-14 10:49:00+00:00
layout: post
slug: are_utf8_angered_disaster
title: 都是utf8惹得祸
wordpress_id: 88
categories:
- PHP
tags:
- php
---

今天继续着先前的基因图谱分析系统的开发。每天一个bug要攻破，我已习以为常了。还记得昨天我把一个特别严重的难题给解决了，很是激动，晚上骑着单车恨不得要在校园大叫几句：Yes，I can do that!可是好景不常，今天我又遇到了新的问题。为了完成一个图表的生成，我从网上参考了一个例子。可是不管怎样都无法生成图像，就是一个红叉。我郁闷了，这是啥回事。记得去年也遇到过这种情况，硬是没解决问题，那咋办呢，我可不想把有限的时间都浪费在这上面。

于是静下心来，想想可能的漏洞。先是把程序看了个遍，没问题啊。我是ctrl+c和ctrl+v的，搞不成计算机也会出错？那是不是PHP的问题或者gd库或者jpgraph的问题呢，可是细想不可能，因为先前开发的系统还是能正常工作的。那是哪里的问题呢？我郁闷啊，越是郁闷越是看不下任何东西。于是，一个人骑着单车在紫金山上逗了几圈，稍微平静了一个烦躁的心情。

洗完澡，吃完饭，脑子总是清醒了许多，于是想那会不会是保存的格式的问题呢。网上老是讨论中文bug，跟我这种情况相似的还真没有。于是，我试着把它保存为默认格式---不行；转为DOS格式---不行；保存为UTF-8(无BOM）,哎呀，我的神啊，总算行了。

原来UTF-8 编码的文件可以分为无 BOM 和 BOM 两种格式。

何谓BOM？

"EF BB BF" 这三个字节就叫BOM，全称是"Byte Order Mard"。在utf8文件中常用BOM来表明这个文件是UTF-8文件，而BOM的本意是在utf16中用。

但是，PHP不能正确处理utf8文件的bom头，而是原样输出 "EF BB BF" 这三个字节， 这可能导致无法之后的php代码无法发送HTTP Header， 要防止这种情况。

原来都是utf8惹得祸！
